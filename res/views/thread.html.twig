{% extends '/app/views/layout.html.twig' %}

{% import _self as macros %}

{% block pageTitle %}{{ subject }} - Externals{% endblock %}

{% macro threadItem(item) %}
    {% set email = item.email %}
    <article id="email-{{ email.id }}" class="clearfix">
        <header>
            <a href="#email-{{ email.id }}"><span class="fa fa-link"></span></a>
            Posted by <a href="mailto:{{ email.from.email }}">{{ email.from.nameOrEmail }}</a>
            <span title="{{ email.date|date }}">{{ email.date|time_diff }}</span>
            <img class="avatar" src="{{ email.from.email|gravatar_avatar({d: 'retro', s: 50}) }}">
        </header>
        {{ email.content|raw }}
        {% for reply in item.replies %}
            {{ _self.threadItem(reply) }}
        {% endfor %}
    </article>
{% endmacro %}

{% block content %}

    <div class="page-header">
        <h1>
            <a href="/"><span class="fa fa-caret-left"></span></a>
            {{ subject }}
        </h1>
    </div>

    <section class="thread">
        {% for item in thread %}
            {{ macros.threadItem(item) }}
        {% endfor %}
    </section>

{% endblock %}
